(async()=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();async function Q(t){return await(await fetch(t)).text()}function at(t){const i=t/2,e=new Float32Array([-i,-i,i,i,-i,i,i,i,i,-i,i,i,-i,-i,-i,-i,i,-i,i,i,-i,i,-i,-i]),n=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,3,2,6,3,6,5,0,1,7,0,7,4,1,2,6,1,6,7,0,3,5,0,5,4]);return{vertices:e,indices:n}}var A=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,i=arguments.length;i--;)t+=arguments[i]*arguments[i];return Math.sqrt(t)});function rt(){var t=new B(9);return B!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function O(){var t=new B(16);return B!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ot(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function ct(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ut(t,i){var e=i[0],n=i[1],s=i[2],a=i[3],r=i[4],o=i[5],c=i[6],u=i[7],h=i[8],l=i[9],v=i[10],d=i[11],M=i[12],p=i[13],f=i[14],x=i[15],j=e*o-n*r,g=e*c-s*r,m=e*u-a*r,b=n*c-s*o,w=n*u-a*o,S=s*u-a*c,F=h*p-l*M,L=h*f-v*M,E=h*x-d*M,q=l*f-v*p,I=l*x-d*p,U=v*x-d*f,y=j*U-g*I+m*q+b*E-w*L+S*F;return y?(y=1/y,t[0]=(o*U-c*I+u*q)*y,t[1]=(s*I-n*U-a*q)*y,t[2]=(p*S-f*w+x*b)*y,t[3]=(v*w-l*S-d*b)*y,t[4]=(c*E-r*U-u*L)*y,t[5]=(e*U-s*E+a*L)*y,t[6]=(f*m-M*S-x*g)*y,t[7]=(h*S-v*m+d*g)*y,t[8]=(r*I-o*E+u*F)*y,t[9]=(n*E-e*I-a*F)*y,t[10]=(M*w-p*m+x*j)*y,t[11]=(l*m-h*w-d*j)*y,t[12]=(o*L-r*q-c*F)*y,t[13]=(e*q-n*L+s*F)*y,t[14]=(p*g-M*b-f*j)*y,t[15]=(h*b-l*g+v*j)*y,t):null}function Z(t,i,e){var n=i[0],s=i[1],a=i[2],r=i[3],o=i[4],c=i[5],u=i[6],h=i[7],l=i[8],v=i[9],d=i[10],M=i[11],p=i[12],f=i[13],x=i[14],j=i[15],g=e[0],m=e[1],b=e[2],w=e[3];return t[0]=g*n+m*o+b*l+w*p,t[1]=g*s+m*c+b*v+w*f,t[2]=g*a+m*u+b*d+w*x,t[3]=g*r+m*h+b*M+w*j,g=e[4],m=e[5],b=e[6],w=e[7],t[4]=g*n+m*o+b*l+w*p,t[5]=g*s+m*c+b*v+w*f,t[6]=g*a+m*u+b*d+w*x,t[7]=g*r+m*h+b*M+w*j,g=e[8],m=e[9],b=e[10],w=e[11],t[8]=g*n+m*o+b*l+w*p,t[9]=g*s+m*c+b*v+w*f,t[10]=g*a+m*u+b*d+w*x,t[11]=g*r+m*h+b*M+w*j,g=e[12],m=e[13],b=e[14],w=e[15],t[12]=g*n+m*o+b*l+w*p,t[13]=g*s+m*c+b*v+w*f,t[14]=g*a+m*u+b*d+w*x,t[15]=g*r+m*h+b*M+w*j,t}function ht(t,i,e){var n=e[0],s=e[1],a=e[2],r,o,c,u,h,l,v,d,M,p,f,x;return i===t?(t[12]=i[0]*n+i[4]*s+i[8]*a+i[12],t[13]=i[1]*n+i[5]*s+i[9]*a+i[13],t[14]=i[2]*n+i[6]*s+i[10]*a+i[14],t[15]=i[3]*n+i[7]*s+i[11]*a+i[15]):(r=i[0],o=i[1],c=i[2],u=i[3],h=i[4],l=i[5],v=i[6],d=i[7],M=i[8],p=i[9],f=i[10],x=i[11],t[0]=r,t[1]=o,t[2]=c,t[3]=u,t[4]=h,t[5]=l,t[6]=v,t[7]=d,t[8]=M,t[9]=p,t[10]=f,t[11]=x,t[12]=r*n+h*s+M*a+i[12],t[13]=o*n+l*s+p*a+i[13],t[14]=c*n+v*s+f*a+i[14],t[15]=u*n+d*s+x*a+i[15]),t}function ft(t,i,e){var n=e[0],s=e[1],a=e[2];return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=i[3]*n,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=i[7]*s,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=i[11]*a,t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function dt(t,i,e,n){var s=n[0],a=n[1],r=n[2],o=Math.hypot(s,a,r),c,u,h,l,v,d,M,p,f,x,j,g,m,b,w,S,F,L,E,q,I,U,y,T;return o<A?null:(o=1/o,s*=o,a*=o,r*=o,c=Math.sin(e),u=Math.cos(e),h=1-u,l=i[0],v=i[1],d=i[2],M=i[3],p=i[4],f=i[5],x=i[6],j=i[7],g=i[8],m=i[9],b=i[10],w=i[11],S=s*s*h+u,F=a*s*h+r*c,L=r*s*h-a*c,E=s*a*h-r*c,q=a*a*h+u,I=r*a*h+s*c,U=s*r*h+a*c,y=a*r*h-s*c,T=r*r*h+u,t[0]=l*S+p*F+g*L,t[1]=v*S+f*F+m*L,t[2]=d*S+x*F+b*L,t[3]=M*S+j*F+w*L,t[4]=l*E+p*q+g*I,t[5]=v*E+f*q+m*I,t[6]=d*E+x*q+b*I,t[7]=M*E+j*q+w*I,t[8]=l*U+p*y+g*T,t[9]=v*U+f*y+m*T,t[10]=d*U+x*y+b*T,t[11]=M*U+j*y+w*T,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)}function J(t,i){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function $(t,i){return t[0]=i[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=i[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y(t,i,e){var n=e[0],s=e[1],a=e[2],r=Math.hypot(n,s,a),o,c,u;return r<A?null:(r=1/r,n*=r,s*=r,a*=r,o=Math.sin(i),c=Math.cos(i),u=1-c,t[0]=n*n*u+c,t[1]=s*n*u+a*o,t[2]=a*n*u-s*o,t[3]=0,t[4]=n*s*u-a*o,t[5]=s*s*u+c,t[6]=a*s*u+n*o,t[7]=0,t[8]=n*a*u+s*o,t[9]=s*a*u-n*o,t[10]=a*a*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function lt(t,i){return t[0]=i[12],t[1]=i[13],t[2]=i[14],t}function tt(t,i){var e=i[0],n=i[1],s=i[2],a=i[4],r=i[5],o=i[6],c=i[8],u=i[9],h=i[10];return t[0]=Math.hypot(e,n,s),t[1]=Math.hypot(a,r,o),t[2]=Math.hypot(c,u,h),t}function vt(t,i){var e=new B(3);tt(e,i);var n=1/e[0],s=1/e[1],a=1/e[2],r=i[0]*n,o=i[1]*s,c=i[2]*a,u=i[4]*n,h=i[5]*s,l=i[6]*a,v=i[8]*n,d=i[9]*s,M=i[10]*a,p=r+h+M,f=0;return p>0?(f=Math.sqrt(p+1)*2,t[3]=.25*f,t[0]=(l-d)/f,t[1]=(v-c)/f,t[2]=(o-u)/f):r>h&&r>M?(f=Math.sqrt(1+r-h-M)*2,t[3]=(l-d)/f,t[0]=.25*f,t[1]=(o+u)/f,t[2]=(v+c)/f):h>M?(f=Math.sqrt(1+h-r-M)*2,t[3]=(v-c)/f,t[0]=(o+u)/f,t[1]=.25*f,t[2]=(l+d)/f):(f=Math.sqrt(1+M-r-h)*2,t[3]=(o-u)/f,t[0]=(v+c)/f,t[1]=(l+d)/f,t[2]=.25*f),t}function it(t,i){var e=i[0],n=i[1],s=i[2],a=i[3],r=e+e,o=n+n,c=s+s,u=e*r,h=n*r,l=n*o,v=s*r,d=s*o,M=s*c,p=a*r,f=a*o,x=a*c;return t[0]=1-l-M,t[1]=h+x,t[2]=v-f,t[3]=0,t[4]=h-x,t[5]=1-u-M,t[6]=d+p,t[7]=0,t[8]=v+f,t[9]=d-p,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mt(t,i,e,n,s){var a=1/Math.tan(i/2),r;return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(r=1/(n-s),t[10]=(s+n)*r,t[14]=2*s*n*r):(t[10]=-1,t[14]=-2*n),t}var k=Mt;function D(t,i,e,n){var s,a,r,o,c,u,h,l,v,d,M=i[0],p=i[1],f=i[2],x=n[0],j=n[1],g=n[2],m=e[0],b=e[1],w=e[2];return Math.abs(M-m)<A&&Math.abs(p-b)<A&&Math.abs(f-w)<A?ct(t):(h=M-m,l=p-b,v=f-w,d=1/Math.hypot(h,l,v),h*=d,l*=d,v*=d,s=j*v-g*l,a=g*h-x*v,r=x*l-j*h,d=Math.hypot(s,a,r),d?(d=1/d,s*=d,a*=d,r*=d):(s=0,a=0,r=0),o=l*r-v*a,c=v*s-h*r,u=h*a-l*s,d=Math.hypot(o,c,u),d?(d=1/d,o*=d,c*=d,u*=d):(o=0,c=0,u=0),t[0]=s,t[1]=o,t[2]=h,t[3]=0,t[4]=a,t[5]=c,t[6]=l,t[7]=0,t[8]=r,t[9]=u,t[10]=v,t[11]=0,t[12]=-(s*M+a*p+r*f),t[13]=-(o*M+c*p+u*f),t[14]=-(h*M+l*p+v*f),t[15]=1,t)}var X=Z;function z(){var t=new B(3);return B!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pt(t){var i=t[0],e=t[1],n=t[2];return Math.hypot(i,e,n)}function N(t,i,e){var n=new B(3);return n[0]=t,n[1]=i,n[2]=e,n}function gt(t,i,e){return t[0]=i[0]-e[0],t[1]=i[1]-e[1],t[2]=i[2]-e[2],t}function mt(t,i,e){return t[0]=i[0]*e,t[1]=i[1]*e,t[2]=i[2]*e,t}function et(t,i){var e=i[0],n=i[1],s=i[2],a=e*e+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t}function bt(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}function _(t,i,e){var n=i[0],s=i[1],a=i[2],r=e[0],o=e[1],c=e[2];return t[0]=s*c-a*o,t[1]=a*r-n*c,t[2]=n*o-s*r,t}function wt(t,i,e){var n=i[0],s=i[1],a=i[2],r=e[3]*n+e[7]*s+e[11]*a+e[15];return r=r||1,t[0]=(e[0]*n+e[4]*s+e[8]*a+e[12])/r,t[1]=(e[1]*n+e[5]*s+e[9]*a+e[13])/r,t[2]=(e[2]*n+e[6]*s+e[10]*a+e[14])/r,t}var xt=pt;(function(){var t=z();return function(i,e,n,s,a,r){var o,c;for(e||(e=3),n||(n=0),s?c=Math.min(s*e+n,i.length):c=i.length,o=n;o<c;o+=e)t[0]=i[o],t[1]=i[o+1],t[2]=i[o+2],a(t,t,r),i[o]=t[0],i[o+1]=t[1],i[o+2]=t[2];return i}})();function yt(){var t=new B(4);return B!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ot(t,i){var e=i[0],n=i[1],s=i[2],a=i[3],r=e*e+n*n+s*s+a*a;return r>0&&(r=1/Math.sqrt(r)),t[0]=e*r,t[1]=n*r,t[2]=s*r,t[3]=a*r,t}(function(){var t=yt();return function(i,e,n,s,a,r){var o,c;for(e||(e=4),n||(n=0),s?c=Math.min(s*e+n,i.length):c=i.length,o=n;o<c;o+=e)t[0]=i[o],t[1]=i[o+1],t[2]=i[o+2],t[3]=i[o+3],a(t,t,r),i[o]=t[0],i[o+1]=t[1],i[o+2]=t[2],i[o+3]=t[3];return i}})();function W(){var t=new B(4);return B!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jt(t,i,e){e=e*.5;var n=Math.sin(e);return t[0]=n*i[0],t[1]=n*i[1],t[2]=n*i[2],t[3]=Math.cos(e),t}function H(t,i,e,n){var s=i[0],a=i[1],r=i[2],o=i[3],c=e[0],u=e[1],h=e[2],l=e[3],v,d,M,p,f;return d=s*c+a*u+r*h+o*l,d<0&&(d=-d,c=-c,u=-u,h=-h,l=-l),1-d>A?(v=Math.acos(d),M=Math.sin(v),p=Math.sin((1-n)*v)/M,f=Math.sin(n*v)/M):(p=1-n,f=n),t[0]=p*s+f*c,t[1]=p*a+f*u,t[2]=p*r+f*h,t[3]=p*o+f*l,t}function Bt(t,i){var e=i[0]+i[4]+i[8],n;if(e>0)n=Math.sqrt(e+1),t[3]=.5*n,n=.5/n,t[0]=(i[5]-i[7])*n,t[1]=(i[6]-i[2])*n,t[2]=(i[1]-i[3])*n;else{var s=0;i[4]>i[0]&&(s=1),i[8]>i[s*3+s]&&(s=2);var a=(s+1)%3,r=(s+2)%3;n=Math.sqrt(i[s*3+s]-i[a*3+a]-i[r*3+r]+1),t[s]=.5*n,n=.5/n,t[3]=(i[a*3+r]-i[r*3+a])*n,t[a]=(i[a*3+s]+i[s*3+a])*n,t[r]=(i[r*3+s]+i[s*3+r])*n}return t}function Pt(t,i,e,n){var s=.5*Math.PI/180;i*=s,e*=s,n*=s;var a=Math.sin(i),r=Math.cos(i),o=Math.sin(e),c=Math.cos(e),u=Math.sin(n),h=Math.cos(n);return t[0]=a*c*h-r*o*u,t[1]=r*o*h+a*c*u,t[2]=r*c*u-a*o*h,t[3]=r*c*h+a*o*u,t}var nt=Ot;(function(){var t=z(),i=N(1,0,0),e=N(0,1,0);return function(n,s,a){var r=bt(s,a);return r<-.999999?(_(t,i,s),xt(t)<1e-6&&_(t,e,s),et(t,t),jt(n,t,Math.PI),n):r>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_(t,s,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+r,nt(n,n))}})(),function(){var t=W(),i=W();return function(e,n,s,a,r,o){return H(t,n,r,o),H(i,s,a,o),H(e,t,i,2*o*(1-o)),e}}(),function(){var t=rt();return function(i,e,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],nt(i,Bt(i,t))}}();class Gt{constructor(i){this.canvas=i,this.device=null,this.context=null,this.canvasFormat=null,this.pipeline=null,this.projectionMatrix=O(),this.viewMatrix=O(),this.modelMatrix=O(),this.uniformBuffer=null,this.uniformBindGroup=null,this.uniformBindGroupLayout=null,this.isInitialized=!1,this.backgroundColor={r:.2,g:.2,b:.2,a:1}}async initialize(){if(!navigator.gpu)throw new Error("WebGPU is not supported");const i=await navigator.gpu.requestAdapter();if(!i)throw new Error("No adapter found");return this.device=await i.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),this.context.configure({device:this.device,format:this.canvasFormat}),this.isInitialized=!0,this}checkIfInitialized(){this.isInitialized||this.initialize()}initPipeline(i,e){this.checkIfInitialized();const n=this.device.createShaderModule({code:i}),s=this.device.createShaderModule({code:e}),a=200;this.uniformBuffer=this.device.createBuffer({size:2*4*4*4+a*4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),this.uniformBindGroup=this.device.createBindGroup({layout:this.uniformBindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const r=this.device.createPipelineLayout({bindGroupLayouts:[this.uniformBindGroupLayout]}),o={arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]};return this.pipeline=this.device.createRenderPipeline({layout:r,vertex:{module:n,entryPoint:"main",buffers:[o]},fragment:{module:s,entryPoint:"main",targets:[{format:this.canvasFormat}]},primitive:{topology:"triangle-list"}}),this}updateUniforms(){const i=new Float32Array(48);i.set(this.projectionMatrix,0),i.set(this.viewMatrix,4*4),i.set(this.modelMatrix,8*4),this.device.queue.writeBuffer(this.uniformBuffer,0,i)}createPerspectiveMatrix(i,e,n,s){const a=O();return k(a,i,e,n,s),a}createViewMatrix(i,e,n){const s=O();return D(s,i,e,n),s}createModelMatrix(i,e,n){const s=J(O(),i),a=Y(O(),e),r=$(O(),n);return modelMatrix=O(),X(this.modelMatrix,this.modelMatrix,s),X(this.modelMatrix,this.modelMatrix,a),X(this.modelMatrix,this.modelMatrix,r),modelMatrix}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context.configure({device:this.device,format:this.canvasFormat,size:{width:this.canvas.width,height:this.canvas.height}});const i=this.canvas.width/this.canvas.height;this.perspectiveMatrix=this.createPerspectiveMatrix(Math.PI/4,i,.1,100),this.updateUniforms()}createBuffer(i,e){const n=this.device.createBuffer({size:i.byteLength,usage:e});return this.device.queue.writeBuffer(n,0,i),n}bufferGeometry(i){const e=this.createBuffer(i.vertices,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),n=this.createBuffer(i.indices,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST);return{vertexBuffer:e,indexBuffer:n}}startRenderPass(){const i=this.device.createCommandEncoder(),e=i.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:this.backgroundColor,storeOp:"store"}]});return e.setPipeline(this.pipeline),e.setBindGroup(0,this.uniformBindGroup),{encoder:i,pass:e}}endRenderPass(i){i.pass.end(),this.device.queue.submit([i.encoder.finish()])}}class St{constructor(i,e,n,s){this.position=[0,0,5],this.target=[0,0,0],this.up=[0,1,0],this.projectionMatrix=k(O(),i,e,n,s),this.viewMatrix=D(O(),this.position,this.target,this.up)}updateViewMatrix(){this.viewMatrix=D(O(),this.position,this.target,this.up)}setTransform(i,e,n){this.position=i,this.target=e,this.up=n,this.updateViewMatrix()}translate(i){this.position=vec3.add(this.position,this.position,i),this.updateViewMatrix()}rotate(i){this.target=vec3.transformMat4(this.target,this.target,Y(O(),i)),this.up=vec3.transformMat4(this.up,this.up,Y(O(),i)),this.updateViewMatrix()}}class Ft{constructor(i){this.sceneObjects=[],this.engine=i}createSceneObject(i,e=null,n=null){let s=null,a=null,r=[];n&&(a=n),e?s=e:s=O();const o={geometry:i,modelMatrix:s,parent:a,children:r};return this.sceneObjects.push(o),this.sceneObjects.length-1}addChild(i,e){this.sceneObjects[i].children.push(e),this.sceneObjects[e].parent=i}getParentObject(i){return this.sceneObjects[i].parent===null?null:this.sceneObjects[this.sceneObjects[i].parent]}getParentObjectID(i){return this.sceneObjects[i].parent}getChildObjectIDs(i){return this.sceneObjects[i].children}getSceneObject(i){return this.sceneObjects[i]}getFullModelMatrix(i){let e=O(),n=this.sceneObjects[i];for(;n&&(Z(e,n.modelMatrix,e),n.parent!==null);)n=this.getParentObject(n);return e}updateModelMatrix(i,e){ot(this.sceneObjects[i].modelMatrix,e)}translateSceneObject(i,e){ht(this.sceneObjects[i].modelMatrix,this.sceneObjects[i].modelMatrix,e)}rotateSceneObject(i,e){dt(this.sceneObjects[i].modelMatrix,this.sceneObjects[i].modelMatrix,e,[0,1,0])}scaleSceneObject(i,e){ft(this.sceneObjects[i].modelMatrix,this.sceneObjects[i].modelMatrix,e)}getObjectTranslationVector(i){const e=z();return lt(e,this.sceneObjects[i].modelMatrix),e}getObjectRotationVector(i){const e=z();return vt(e,this.sceneObjects[i].modelMatrix),e}getObjectScaleVector(i){const e=z();return tt(e,this.sceneObjects[i].modelMatrix),e}setObjectXYZ(i,e,n,s){const a=N(e,n,s);J(this.sceneObjects[i].modelMatrix,a)}setObjectRPY(i,e,n,s){const a=W();Pt(a,e,n,s),it(this.sceneObjects[i].modelMatrix,a)}setObjectQuat(i,e){it(this.sceneObjects[i].modelMatrix,e)}setObjectScale(i,e,n,s){const a=N(e,n,s);$(this.sceneObjects[i].modelMatrix,a)}render(i){if(!i){console.error("Camera is not defined");return}if(!this.engine){console.error("Engine is not defined");return}const e=this.engine.startRenderPass(),n=i.projectionMatrix,s=i.viewMatrix;this.engine.device.queue.writeBuffer(this.engine.uniformBuffer,0,n.buffer,n.byteOffset,n.byteLength),this.engine.device.queue.writeBuffer(this.engine.uniformBuffer,64,s.buffer,s.byteOffset,s.byteLength),this.sceneObjects.forEach((a,r)=>{const o=128+r*64,c=this.getFullModelMatrix(r),u=this.engine.bufferGeometry(a.geometry);this.engine.device.queue.writeBuffer(this.engine.uniformBuffer,o,c.buffer,c.byteOffset,c.byteLength),e.pass.setBindGroup(0,this.engine.uniformBindGroup),e.pass.setVertexBuffer(0,u.vertexBuffer),e.pass.setIndexBuffer(u.indexBuffer,"uint16"),e.pass.drawIndexed(a.geometry.indices.length,1,0,0,r)}),this.engine.endRenderPass(e)}}const P=document.querySelector("canvas"),C=new Gt(P);await C.initialize();const Lt=await Q("./src/shaders/vert.wgsl"),Et=await Q("./src/shaders/frag.wgsl");C.initPipeline(Lt,Et);const V=new Ft(C),K=[],R=new St(45*Math.PI/180,P.width/P.height,.1,100),qt=[0,0,20],It=[0,0,0],Ut=[0,1,0];R.viewMatrix=D(O(),qt,It,Ut);const zt=200;for(let t=0;t<zt;t++){const i=new at(.5),e=V.createSceneObject(i);K.push(e);const n=Math.random()*30-15,s=Math.random()*30-15,a=Math.random()*30-15;V.translateSceneObject(e,[n,s,a])}function st(){P.width=window.innerWidth,P.height=window.innerHeight,C.context.configure({device:C.device,format:C.canvasFormat,size:{width:P.width,height:P.height}}),R.projectionMatrix=k(O(),45*Math.PI/180,P.width/P.height,.1,100),V.render(R)}st(),window.addEventListener("resize",st);let G={x:0,y:0,u:0,v:0};window.addEventListener("mousemove",t=>{G.x=t.clientX,G.y=t.clientY,G.u=G.x/P.width,G.v=G.y/P.height,G.nx=G.u*2-1,G.ny=-(G.v*2-1)});function At(t,i){const e=N(t.nx,t.ny,1),n=ut(O(),i.projectionMatrix);return n?wt(z(),e,n):(console.error("Matrix inversion failed"),z())}for(;;){const t=At(G,R);t[2]=0;const i=.03;for(let e=0;e<K.length;e++){const n=K[e],s=V.getObjectTranslationVector(n),a=gt(z(),t,s),r=et(z(),a),o=mt(z(),r,i);isNaN(o[0])||isNaN(o[1])||isNaN(o[2])||V.translateSceneObject(n,o)}V.render(R),await new Promise(e=>setTimeout(e,1e3/60))}})();
